# ææ‡‚SpringCloudå¾®æœåŠ¡æ¶æ„

## å‰è¨€

å¾®æœåŠ¡æ¶æ„å·²ç»æµè¡Œå¾ˆé•¿æ—¶é—´äº†ï¼Œå¦‚æœè¦é—®ä¸ºä»€ä¹ˆè¦ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œé‚£å…ˆæ¥è¯´ä¸€ä¸‹ä¸€ä½“åŒ–æ¶æ„ã€‚

å•ä½“åº”ç”¨å°±æ˜¯å°†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰åŠŸèƒ½éƒ½æ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒã€‚éƒ¨ç½²ç®€å•ï¼Œå¼€å‘æ•ˆç‡â€œé«˜â€ï¼Œä¸Šæ‰‹å®¹æ˜“ï¼Œä½†æ˜¯å®¹æ˜“å‡ºç°ç³»ç»Ÿé£é™©ï¼Œä¸€ä¸ªéä¸»è¦åŠŸèƒ½ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ï¼Œæ€§èƒ½ã€ç¨³å®šæ€§éš¾ä»¥ä¼˜åŒ–ç­‰ç­‰é—®é¢˜ã€‚

å¾®æœåŠ¡å°±æ˜¯æŠŠä¸€ä¸ªå¤§ç³»ç»ŸæŒ‰ä¸šåŠ¡åŠŸèƒ½**åˆ†è§£**æˆå¤šä¸ªå°ç³»ç»Ÿï¼Œå¹¶åˆ©ç”¨ç®€å•çš„æ–¹æ³•ä½¿å¤šå°ç³»ç»Ÿç›¸äº’åä½œï¼Œ**ç»„åˆ**æˆä¸€ä¸ªå¤§ç³»ç»Ÿã€‚ä¼˜åŠ¿æ˜¯è§„é¿ç³»ç»Ÿæ€§é£é™©ï¼Œè½»ç®¡ç† ï¼Œè¿­ä»£å¿«ã€é™æˆæœ¬ã€æœ‰åˆ©äºé•¿æœŸå‘å±•ã€‚

## ä»€ä¹ˆæ˜¯Spring Cloudï¼Ÿ

Spring Cloudä¸ºå¼€å‘äººå‘˜æä¾›äº†å¿«é€Ÿæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸€äº›å¸¸è§æ¨¡å¼çš„å·¥å…·ï¼ˆä¾‹å¦‚é…ç½®ç®¡ç†ï¼ŒæœåŠ¡å‘ç°ï¼Œæ–­è·¯å™¨ï¼Œæ™ºèƒ½è·¯ç”±ï¼Œå¾®ä»£ç†ï¼Œæ§åˆ¶æ€»çº¿ï¼‰ã€‚è€Œ Spring Cloud ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€å¥—ç®€æ˜“çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä½¿æˆ‘ä»¬èƒ½åœ¨ Spring Boot çš„åŸºç¡€ä¸Šè½»æ¾åœ°å®ç°å¾®æœåŠ¡é¡¹ç›®çš„æ„å»ºã€‚

## Spring Cloudçš„ç‰¹æ€§

Spring Cloudä¸“æ³¨äºæä¾›è‰¯å¥½çš„å¼€ç®±å³ç”¨ç»éªŒçš„å…¸å‹ç”¨ä¾‹å’Œå¯æ‰©å±•æ€§æœºåˆ¶è¦†ç›–ã€‚

- æœåŠ¡æ³¨å†Œå’Œå‘ç°

- åˆ†å¸ƒå¼/ç‰ˆæœ¬åŒ–é…ç½®
- è·¯ç”±
- service - to - serviceè°ƒç”¨
- è´Ÿè½½å‡è¡¡
- æ–­è·¯å™¨
- åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’

ä»¥ä¸‹æ˜¯Spring Cloudä½“ç³»æ‰€åŒ…å«çš„æ¶æ„å›¾ï¼Œå¦‚æœå¤§å®¶å¯¹è¿™å¼ å›¾æœ‰ä¸å¤ªæ˜ç™½çš„åœ°æ–¹ï¼Œæˆ‘ç›¸ä¿¡çœ‹å®Œè¿™ç¯‡æ–‡ç« ä½ ä¼šæç„¶å¤§æ‚Ÿçš„ã€‚

![img](img/ææ‡‚SpringCloudå¾®æœåŠ¡æ¶æ„/0.png)

## Spring Cloudç‰ˆæœ¬

Spring Cloudæ˜¯ä¸€ä¸ªæ‹¥æœ‰è¯¸å¤šå­é¡¹ç›®çš„å¤§å‹ç»¼åˆé¡¹ç›®ï¼ŒåŸåˆ™ä¸Šå…¶å­é¡¹ç›®ä¹Ÿéƒ½ç»´æŠ¤ç€è‡ªå·±çš„å‘å¸ƒç‰ˆæœ¬å·ã€‚é‚£ä¹ˆæ¯ä¸€ä¸ªSpring Cloudçš„ç‰ˆæœ¬éƒ½ä¼šåŒ…å«ä¸åŒçš„å­é¡¹ç›®ç‰ˆæœ¬ï¼Œä¸ºäº†è¦ç®¡ç†æ¯ä¸ªç‰ˆæœ¬çš„å­é¡¹ç›®æ¸…å•ï¼Œé¿å…ç‰ˆæœ¬åä¸å­é¡¹ç›®çš„å‘å¸ƒå·æ··æ·†ï¼Œæ‰€ä»¥æ²¡æœ‰é‡‡ç”¨ç‰ˆæœ¬å·çš„æ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡å‘½åçš„æ–¹å¼ã€‚

é€šè¿‡ä¸‹è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€ŸæŸ¥é˜…å½“å‰å„ç‰ˆæœ¬æ‰€åŒ…å«çš„å­é¡¹ç›®ï¼Œä»¥åŠå„å­é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œé€šè¿‡æ­¤æ¥å†³å®šéœ€è¦é€‰æ‹©æ€ä¹ˆæ ·çš„ç‰ˆæœ¬ã€‚

| Spring Boot | Spring Cloud | Spring Cloud Alibaba |
| :---------- | :----------- | :------------------- |
| 2.1.x       | Greenwich    | 0.9.x                |
| 2.0.x       | Finchley     | 0.2.x                |
| 1.5.x       | Edgware      | 0.1.x                |
| 1.5.x       | Dalston      | 0.1.x                |

## Spring CloudæœåŠ¡å‘ç°æ¡†æ¶ - Eureka

> æœåŠ¡å‘ç°æ˜¯åŸºäºå¾®æœåŠ¡æ¶æ„çš„å…³é”®åŸåˆ™ä¹‹ä¸€ã€‚å°è¯•é…ç½®æ¯ä¸ªå®¢æˆ·ç«¯æˆ–æŸç§å½¢å¼çš„çº¦å®šå¯èƒ½éå¸¸å›°éš¾ï¼Œå¯ä»¥éå¸¸è„†å¼±ã€‚NetflixæœåŠ¡å‘ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ˜¯Eurekaã€‚å¯ä»¥å°†æœåŠ¡å™¨é…ç½®å’Œéƒ¨ç½²ä¸ºé«˜å¯ç”¨æ€§ï¼Œæ¯ä¸ªæœåŠ¡å™¨å°†æ³¨å†ŒæœåŠ¡çš„çŠ¶æ€å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚

åˆ°åº•æ˜¯æœåŠ¡å‘ç°ï¼Ÿä»€ä¹ˆåˆæ˜¯æœåŠ¡æ³¨å†Œå‘¢ï¼Ÿ

ä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œå°±åƒæˆ‘ä»¬å¹³æ—¶æ‰¾å·¥ä½œå»æ‰¾äººåŠ›èµ„æºå…¬å¸ä¸€æ ·ï¼Œæ¯”å¦‚ä¸Šå„ç§æ±‚èŒAPPã€‚

åœ¨æ²¡æœ‰äººåŠ›èµ„æºå…¬å¸çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å®¶å®¶å…¬å¸çš„å»æ‰¾æ˜¯å¦æœ‰åˆé€‚çš„å·¥ä½œå²—ä½ï¼Œè¿™æ˜¾ç„¶éå¸¸çš„è´¹æ—¶è´¹åŠ›ï¼Œä¸€æ–¹é¢ä½ æ˜¯æ‰¾ä¸åˆ°é‚£ä¹ˆå·¥ä½œå²—ä½çš„èµ„æºï¼Œå¦ä¸€æ–¹é¢ä½ ä¹Ÿä¸å¯èƒ½é‚£ä¹ˆè´¹æ—¶çš„æ‰¾ä¸‹å»ï¼Œå¯èƒ½æ‰¾ç€æ‰¾ç€æ²¡æœ‰åˆé€‚çš„å°±å°†å°±å°†å°±äº†ã€‚è¿™é‡Œçš„æ±‚èŒè€…å°±æ˜¯æ¶ˆè´¹è€…ï¼Œè€Œé‚£äº›æ‹›è˜çš„å…¬å¸å°±æ˜¯ç”Ÿäº§è€…ã€‚æ¶ˆè´¹è€…éœ€è¦ç”Ÿäº§è€…æä¾›çš„æœåŠ¡ï¼Œå°±åƒæˆ‘ä»¬éœ€è¦å»ä»–ä»¬å…¬å¸æä¾›çš„å²—ä½å·¥ä½œä¸€æ ·ã€‚

å¦‚æœå…‰æ˜¯æ±‚èŒè€…ä¸æ‹›è˜å…¬å¸ä¹‹é—´ç›¸äº’æ‰¾ï¼Œæ•ˆç‡è‚¯å®šæ˜¯éå¸¸ä½çš„ï¼Œæ‹›è˜å…¬å¸æ‹›ä¸åˆ°åˆé€‚çš„äººæ‰å½±å“å‘å±•ï¼Œæ±‚èŒè€…æ‰¾ä¸åˆ°åˆé€‚çš„å·¥ä½œæ²¡é’±æ— æ³•ç”Ÿæ´»ã€‚éœ€æ±‚æ¥äº†å°±éœ€è¦è§£å†³æ–¹æ¡ˆï¼Œäºæ˜¯æ‹›è˜å…¬å¸å¼€å§‹å››å¤„å‘ä¼ å•è´´å¹¿å‘Šï¼Œè¿™é‡Œæ‹›è˜å…¬å¸å®Œæˆäº†è‡ªå·±çš„ä»»åŠ¡ï¼ŒæŠŠæ‹›è˜å²—ä½å‘å‡ºå»äº†ï¼Œä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œä¸æ˜¯æ±‚èŒçš„äººä¹Ÿçœ‹åˆ°äº†è¿™äº›æ¶ˆæ¯ï¼Œåœ¨ç°å®ä¸–ç•Œä¸­å¯èƒ½æ²¡ä»€ä¹ˆï¼Œä½†æ˜¯è®¡ç®—æœºä¸–ç•Œä¸­è¿™å°±æ˜¯èµ„æºæ¶ˆè€—ï¼Œå¦ä¸€æ–¹é¢ï¼Œæ±‚èŒè€…ä¹Ÿä¸èƒ½æ—¶åˆ»çš„å»æ‰¾è·¯è¾¹çš„å¹¿å‘Šï¼Œè¿™ä¸ªå°±éå¸¸çš„éº»çƒ¦ã€‚

é‚£æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿå¤§å®¶éƒ½å»æ‰¾äººåŠ›èµ„æºå…¬å¸é˜¿ï¼Œæ¯”å¦‚éœ€è¦æ‹›è˜çš„å…¬å¸ï¼ŒæŠŠè‡ªå·±éœ€è¦æ‹›è˜çš„å²—ä½å…¨éƒ¨æ‰˜ä»˜ç»™äººåŠ›èµ„æºå…¬å¸ï¼Œè€Œæ±‚èŒè€…éœ€è¦æ‰¾å·¥ä½œç¬¬ä¸€æ—¶é—´å»äººåŠ›èµ„æºå…¬å¸æŸ¥çœ‹ã€‚

å¯¹äºä¸Šé¢çš„é—®é¢˜ï¼Œç”»å‡ºä¸‹é¢çš„å›¾ï¼š

![image-20200402145150768](img/ææ‡‚SpringCloudå¾®æœåŠ¡æ¶æ„/1.png)

**æœåŠ¡å‘ç°**ï¼šå…¶å®å°±æ˜¯ä¸€ä¸ªâ€œèµ„æºä¸­å¿ƒâ€ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­æœ‰ä¸‰ä¸ªè§’è‰²ï¼š**æœåŠ¡æä¾›è€…(æä¾›å²—ä½)ã€æœåŠ¡æ¶ˆè´¹è€…(æ‰¾å·¥ä½œ)ã€æœåŠ¡ä¸­ä»‹(äººåŠ›èµ„æºä¸­å¿ƒ)**ã€‚

**æœåŠ¡æä¾›è€…**ï¼šå°±æ˜¯æä¾›ä¸€äº›è‡ªå·±èƒ½å¤Ÿæ‰§è¡Œçš„ä¸€äº›æœåŠ¡ç»™å¤–ç•Œã€‚

**æœåŠ¡æ¶ˆè´¹è€…**ï¼šå°±æ˜¯éœ€è¦ä½¿ç”¨ä¸€äº›æœåŠ¡çš„â€œç”¨æˆ·â€ã€‚

**æœåŠ¡ä¸­ä»‹**ï¼šå…¶å®å°±æ˜¯æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ä¹‹é—´çš„â€œæ¡¥æ¢â€ï¼ŒæœåŠ¡æä¾›è€…å¯ä»¥æŠŠè‡ªå·±æ³¨å†Œåˆ°æœåŠ¡ä¸­ä»‹é‚£é‡Œï¼Œè€ŒæœåŠ¡æ¶ˆè´¹è€…å¦‚éœ€è¦æ¶ˆè´¹ä¸€äº›æœåŠ¡(ä½¿ç”¨ä¸€äº›åŠŸèƒ½)å°±å¯ä»¥åœ¨æœåŠ¡ä¸­ä»‹ä¸­å¯»æ‰¾æ³¨å†Œåœ¨æœåŠ¡ä¸­ä»‹çš„æœåŠ¡æä¾›è€…ã€‚

**æœåŠ¡æ³¨å†Œ Register**ï¼š

å®˜æ–¹è§£é‡Šï¼šå½“ Eureka å®¢æˆ·ç«¯å‘`[Eureka] Server`æ³¨å†Œæ—¶ï¼Œå®ƒæä¾›è‡ªèº«çš„**å…ƒæ•°æ®**ï¼Œæ¯”å¦‚IPåœ°å€ã€ç«¯å£ï¼Œè¿è¡ŒçŠ¶å†µæŒ‡ç¤ºç¬¦URLï¼Œä¸»é¡µç­‰ã€‚

ç»“åˆäººåŠ›èµ„æºä¸­å¿ƒç†è§£ï¼šå…¬å¸ (æä¾›è€…`[Eureka] Client Provider`)åœ¨äººåŠ›èµ„æºä¸­å¿ƒ (æœåŠ¡å™¨`[Eureka] Server`) é‚£é‡Œç™»è®°å²—ä½çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å·¥ç¨‹å¸ˆã€æ¶æ„å¸ˆã€CTOç­‰ç­‰(å…ƒæ•°æ®`metaData`)ã€‚

å½“ç„¶é™¤äº†Eurekaï¼Œè¿˜æœ‰å…¶ä»–å……å½“æœåŠ¡å‘ç°çš„ç»„ä»¶ï¼Œæ¯”å¦‚Nacosï¼ŒZookeeperï¼ŒConsul ç­‰ã€‚

## Spring Cloudçš„æ–­è·¯å™¨ - Hystrix

> åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸å¯é¿å…åœ°ä¼šæœ‰è®¸å¤šæœåŠ¡ä¾èµ–é¡¹ä¸­çš„æŸäº›å¤±è´¥ã€‚Hystrixæ˜¯ä¸€ä¸ªåº“ï¼Œå¯é€šè¿‡æ·»åŠ ç­‰å¾…æ—¶é—´å®¹é™å’Œå®¹é”™é€»è¾‘æ¥å¸®åŠ©æ‚¨æ§åˆ¶è¿™äº›åˆ†å¸ƒå¼æœåŠ¡ä¹‹é—´çš„äº¤äº’ã€‚Hystrixé€šè¿‡éš”ç¦»æœåŠ¡ä¹‹é—´çš„è®¿é—®ç‚¹ï¼Œåœæ­¢æœåŠ¡ä¹‹é—´çš„çº§è”æ•…éšœå¹¶æä¾›åå¤‡é€‰é¡¹æ¥å®ç°æ­¤ç›®çš„ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“å¼¹æ€§ã€‚

æ€»ä½“æ¥è¯´`[Hystrix]`å°±æ˜¯ä¸€ä¸ªèƒ½è¿›è¡Œ**ç†”æ–­**å’Œ**é™çº§**çš„åº“ï¼Œé€šè¿‡ä½¿ç”¨å®ƒèƒ½æé«˜æ•´ä¸ªç³»ç»Ÿçš„å¼¹æ€§ã€‚

é‚£ä¹ˆä»€ä¹ˆæ˜¯ ç†”æ–­å’Œé™çº§ å‘¢ï¼Ÿå†ä¸¾ä¸ªä¾‹å­ï¼Œæ­¤æ—¶æˆ‘ä»¬æ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿæ˜¯è¿™æ ·çš„ã€‚æœåŠ¡Aè°ƒç”¨äº†æœåŠ¡Bï¼ŒæœåŠ¡Bå†è°ƒç”¨äº†æœåŠ¡Cï¼Œä½†æ˜¯å› ä¸ºæŸäº›åŸå› ï¼ŒæœåŠ¡Cé¡¶ä¸ä½äº†ï¼Œè¿™ä¸ªæ—¶å€™å¤§é‡è¯·æ±‚ä¼šåœ¨æœåŠ¡Cé˜»å¡ã€‚

æœåŠ¡Cé˜»å¡äº†è¿˜å¥½ï¼Œæ¯•ç«Ÿåªæ˜¯ä¸€ä¸ªç³»ç»Ÿå´©æºƒäº†ã€‚ä½†æ˜¯è¯·æ³¨æ„è¿™ä¸ªæ—¶å€™å› ä¸ºæœåŠ¡Cä¸èƒ½è¿”å›å“åº”ï¼Œé‚£ä¹ˆæœåŠ¡Bè°ƒç”¨æœåŠ¡Cçš„çš„è¯·æ±‚å°±ä¼šé˜»å¡ï¼ŒåŒç†æœåŠ¡Bé˜»å¡äº†ï¼Œé‚£ä¹ˆæœåŠ¡Aä¹Ÿä¼šé˜»å¡å´©æºƒã€‚

> è¯·æ³¨æ„ï¼Œä¸ºä»€ä¹ˆé˜»å¡ä¼šå´©æºƒã€‚å› ä¸ºè¿™äº›è¯·æ±‚ä¼šæ¶ˆè€—å ç”¨ç³»ç»Ÿçš„çº¿ç¨‹ã€IO ç­‰èµ„æºï¼Œæ¶ˆè€—å®Œä½ è¿™ä¸ªç³»ç»ŸæœåŠ¡å™¨ä¸å°±å´©äº†ä¹ˆã€‚

Netflixçš„åˆ›é€ äº†ä¸€ä¸ªè°ƒç”¨çš„åº“Hystrixå®ç°äº†æœåŠ¡ç†”æ–­ã€‚åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé€šå¸¸æœ‰å¤šå±‚æœåŠ¡è°ƒç”¨ã€‚

![image-20200402151238502](img/ææ‡‚SpringCloudå¾®æœåŠ¡æ¶æ„/2.png)

è¾ƒä½çº§åˆ«çš„æœåŠ¡ä¸­çš„æœåŠ¡æ•…éšœå¯èƒ½å¯¼è‡´æ•´ä¸ªé“¾è·¯æ•…éšœã€‚å¯ä»¥å¯¹ç‰¹å®šæœåŠ¡çš„è®¾ç½®å‘¼å«è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶ï¼ˆHystrixä¸­çš„é»˜è®¤å€¼ä¸º5ç§’å†…çš„20æ¬¡æ•…éšœï¼‰ï¼Œè¿›è¡ŒæœåŠ¡ç†”æ–­ã€‚åœ¨é”™è¯¯å’Œå¼€è·¯çš„æƒ…å†µä¸‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥æä¾›åå¤‡ã€‚

![](img/ææ‡‚SpringCloudå¾®æœåŠ¡æ¶æ„/3.png)

æœåŠ¡é™çº§æ˜¯ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå½“ä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¼‚å¸¸æ—¶ï¼Œé€šè¿‡æ‰§è¡Œå¦ä¸€ç§ä»£ç é€»è¾‘æ¥ç»™ç”¨æˆ·å‹å¥½çš„å›å¤ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œçªç„¶æ¥äº†ä¸€æ¡æ–°é—»éå¸¸ç«ğŸ”¥ï¼Œæ¯”å¦‚æŸæŸæ˜æ˜Ÿåˆå®˜å®£ç»“å©šï¼Œå¯¼è‡´ä¸€ç¬é—´æ¶Œå…¥å¤§é‡çš„è¯·æ±‚åŒæ—¶è®¿é—®å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å°±éœ€è¦åšæœåŠ¡é™çº§ï¼Œä¸€äº›æœåŠ¡éœ€è¦åšé™çº§å¤„ç†æ¯”å¦‚è¿”å›æŸ¥çœ‹äººæ•°å¤ªå¤šè¯·ç¨åæŸ¥çœ‹ç­‰ç­‰ã€‚

## è´Ÿè½½å‡è¡¡ - Ribbon

> Ribbonæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶HTTPå’ŒTCPå®¢æˆ·ç«¯çš„è¡Œä¸ºã€‚Feignå·²ç»ä½¿ç”¨Ribbonï¼Œæ‰€ä»¥å¦‚æœæ‚¨ä½¿ç”¨`@FeignClient`ï¼Œåˆ™æœ¬èŠ‚ä¹Ÿé€‚ç”¨ã€‚

é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦Ribbonå‘¢ï¼Ÿ

ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ç°åœ¨åŒåä¸€å¤§ä¿ƒè¦åˆ°äº†ï¼Œæˆ‘ä»¬éœ€è¦ä¸Šä¸€ä¸ªç§’æ€çš„ç³»ç»Ÿï¼Œä¸ºäº†è¿™ä¸ªç³»ç»Ÿèƒ½å¤Ÿé«˜å¯ç”¨ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªç§’æ€ç³»ç»Ÿåšæˆä¸€ä¸ªé›†ç¾¤ï¼Œè¿™æ—¶æ¶ˆè´¹è€…å°±ä¼šæœ‰å¤šä¸ªè°ƒç”¨é€”å¾„ã€‚

è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åšè´Ÿè½½å‡è¡¡æªæ–½ï¼Œå¯èƒ½å¤šä¸ªè¯·æ±‚æ‰“è¿‡æ¥çš„æ—¶å€™ä¼šè¯·æ±‚åˆ°æŸä¸€ä¸ªæœåŠ¡å™¨ä¸­ï¼Œè¿™ä¸€å°æ‰¿å—ç€å¾ˆå¤§çš„å‹åŠ›ï¼Œå¾ˆå¯èƒ½æœ€åå› ä¸ºæµé‡å¤ªå¤§è€Œå´©æºƒï¼Œè€Œå…¶ä»–çš„æœåŠ¡å™¨å¾ˆç©ºé—²ï¼Œè¿™æ ·å°±è¾¾ä¸åˆ°é«˜å¯ç”¨çš„ç›®çš„ã€‚

è¿™æ—¶ï¼ŒRibbonå°±å¯ä»¥é—ªäº®ç™»åœºï¼Œâš ï¸æ³¨æ„å¼€å¤´è§£é‡Šï¼Œè¿™æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ï¼Œè¿è¡Œåœ¨æ¶ˆè´¹è€…ç«¯çš„ã€‚åœ¨æ¶ˆè´¹è€…æ‹¿åˆ°æœåŠ¡åˆ—è¡¨åï¼Œåœ¨å…¶å†…éƒ¨ä½¿ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå†å¯¹å¤šä¸ªç³»ç»Ÿè¿›è¡Œè°ƒç”¨ã€‚

### Ribbon çš„å‡ ç§è´Ÿè½½å‡è¡¡ç®—æ³•

è´Ÿè½½å‡è¡¡ï¼Œä¸ç®¡`Nginx`è¿˜æ˜¯`Ribbon`éƒ½éœ€è¦å…¶ç®—æ³•çš„æ”¯æŒï¼Œå¦‚æœæˆ‘æ²¡è®°é”™çš„è¯`Nginx`ä½¿ç”¨çš„æ˜¯ è½®è¯¢å’ŒåŠ æƒè½®è¯¢ç®—æ³•ã€‚è€Œåœ¨`Ribbon`ä¸­æœ‰æ›´å¤šçš„è´Ÿè½½å‡è¡¡è°ƒåº¦ç®—æ³•ï¼Œå…¶é»˜è®¤æ˜¯ä½¿ç”¨çš„`RoundRobinRule`è½®è¯¢ç­–ç•¥ã€‚

- **RoundRobinRule**ï¼šè½®è¯¢ç­–ç•¥ã€‚`Ribbon`é»˜è®¤é‡‡ç”¨çš„ç­–ç•¥ã€‚è‹¥ç»è¿‡ä¸€è½®è½®è¯¢æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„`provider`ï¼Œå…¶æœ€å¤šè½®è¯¢ 10 è½®ã€‚è‹¥æœ€ç»ˆè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å› nullã€‚
- **RandomRule**: éšæœºç­–ç•¥ï¼Œä»æ‰€æœ‰å¯ç”¨çš„ provider ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªã€‚
- **RetryRule**: é‡è¯•ç­–ç•¥ã€‚å…ˆæŒ‰ç…§ RoundRobinRule ç­–ç•¥è·å– providerï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™åœ¨æŒ‡å®šçš„æ—¶é™å†…é‡è¯•ã€‚é»˜è®¤çš„æ—¶é™ä¸º 500 æ¯«ç§’ã€‚

## å£°æ˜æ€§RESTå®¢æˆ·ç«¯ï¼šFeign

> [Feign](https://github.com/Netflix/feign)æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„WebæœåŠ¡å®¢æˆ·ç«¯ã€‚è¿™ä½¿å¾—WebæœåŠ¡å®¢æˆ·ç«¯çš„å†™å…¥æ›´åŠ æ–¹ä¾¿ è¦ä½¿ç”¨Feignåˆ›å»ºä¸€ä¸ªç•Œé¢å¹¶å¯¹å…¶è¿›è¡Œæ³¨é‡Šã€‚

é€šè¿‡ä¸Šé¢çš„Eurekaã€Ribbonç­‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„è¿›è¡ŒæœåŠ¡é—´çš„è°ƒç”¨ã€‚ä½†æ˜¯è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œè¿›è¡ŒæœåŠ¡é—´çš„è°ƒç”¨æˆ‘ä»¬ä½¿ç”¨çš„Springæä¾›çš„è®¿é—®HttpæœåŠ¡çš„å®¢æˆ·ç«¯ç±»RestTemplateï¼Œè¿™æ ·è°ƒç”¨æ–¹å¼éœ€è¦æä¾›URLï¼Œæˆ‘ä»¬ç†æƒ³ä¸­çš„çŠ¶æ€æ˜¯å°±åƒå•ä½“åº”ç”¨ç›´æ¥è°ƒç”¨åŸæ¥ä»£ç è¿›è¡ŒæœåŠ¡é—´è°ƒç”¨ã€‚

è¿™ä¸ªæ—¶å€™Feignæ¥äº†ï¼Œå¯ä»¥å®ç°æˆ‘ä»¬ç†æƒ³ä¸­çš„å¼€å‘æ–¹å¼ã€‚

> OpenFeign ä¹Ÿæ˜¯è¿è¡Œåœ¨æ¶ˆè´¹è€…ç«¯çš„ï¼Œä½¿ç”¨ Ribbon è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥ OpenFeign ç›´æ¥å†…ç½®äº† Ribbonã€‚

ç¤ºä¾‹spring bootåº”ç”¨

```java
@Configuration
@ComponentScan
@EnableAutoConfiguration
@EnableEurekaClient
@EnableFeignClients
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

}
```

StoreClient.java

```java
@FeignClient("stores")
public interface StoreClient {
    @RequestMapping(method = RequestMethod.GET, value = "/stores")
    List<Store> getStores();

    @RequestMapping(method = RequestMethod.POST, value = "/stores/{storeId}", consumes = "application/json")
    Store update(@PathVariable("storeId") Long storeId, Store store);
}
```

åœ¨`@FeignClient`æ³¨é‡Šä¸­ï¼ŒStringå€¼ï¼ˆä»¥ä¸Šâ€œå­˜å‚¨â€ï¼‰æ˜¯ä¸€ä¸ªä»»æ„çš„å®¢æˆ·ç«¯åç§°ï¼Œç”¨äºåˆ›å»ºRibbonè´Ÿè½½å‡è¡¡å™¨ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨`url`å±æ€§ï¼ˆç»å¯¹å€¼æˆ–åªæ˜¯ä¸»æœºåï¼‰æŒ‡å®šURLã€‚åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„beançš„åç§°æ˜¯è¯¥æ¥å£çš„å®Œå…¨é™å®šåç§°ã€‚è¦æŒ‡å®šæ‚¨è‡ªå·±çš„åˆ«åå€¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`@FeignClient`æ³¨é‡Šçš„`qualifier`å€¼ã€‚

ä»¥ä¸Šçš„Ribbonå®¢æˆ·ç«¯å°†ä¼šå‘ç°â€œstoresâ€æœåŠ¡çš„ç‰©ç†åœ°å€ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæ˜¯Eurekaå®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆå®ƒå°†è§£æEurekaæœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æœåŠ¡ã€‚

## å¾®æœåŠ¡ç½‘å…³ - Zuul

> è·¯ç”±åœ¨å¾®æœåŠ¡ä½“ç³»ç»“æ„çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œ`/`å¯ä»¥æ˜ å°„åˆ°æ‚¨çš„Webåº”ç”¨ç¨‹åºï¼Œ`/api/users`æ˜ å°„åˆ°ç”¨æˆ·æœåŠ¡ï¼Œå¹¶å°†`/api/shop`æ˜ å°„åˆ°å•†åº—æœåŠ¡ã€‚Zuulæ˜¯Netflixçš„åŸºäºJVMçš„è·¯ç”±å™¨å’ŒæœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡å™¨ã€‚

è¿™é‡Œçš„ç½‘å…³ï¼Œå…¶å®ç½‘ç»œç»“æ„ä¸­ç½‘å…³æ˜¯ä¸€ä¸ªé“ç†ï¼Œå°±å¯ä»¥ç†è§£ä¸ºç³»ç»Ÿçš„ç»Ÿä¸€å…¥å£ã€‚

å›é¡¾ä¹‹å‰çš„å†…å®¹ï¼ŒæœåŠ¡æä¾›è€…æ˜¯æ¶ˆè´¹è€…é€šè¿‡Eureka Serveræ¥è¿›è¡Œè®¿é—®çš„ï¼ŒEureka Serveræ˜¯æœåŠ¡æä¾›è€…çš„å”¯ä¸€å…¥å£ã€‚æ•´ä¸ªç³»ç»Ÿå­˜åœ¨é‚£ä¹ˆå¤šæ¶ˆè´¹è€…éœ€è¦ç”¨æˆ·å»è°ƒç”¨ï¼Œè¿™æ ·ç”¨æˆ·åº”è¯¥æ€ä¹ˆå»è®¿é—®å‘¢ï¼Ÿçš„ç¡®å¯ä»¥æƒ³ä¹‹å‰é‚£æ ·è¿›è¡Œç›´æ¥è®¿é—®éœ€è¦ä½¿ç”¨çš„å·¥ç¨‹ï¼Œä½†æ˜¯è¿™æ ·ä¸ä¾¿äºè®¿é—®ä¸ç®¡ç†ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ï¼Œé‚£ä¹ˆZuulå°±æ˜¯å¯¹æ¶ˆè´¹è€…ç»Ÿä¸€çš„å…¥å£ã€‚

Netflixä½¿ç”¨Zuulè¿›è¡Œä»¥ä¸‹æ“ä½œï¼š

- è®¤è¯
- ç›‘æ§
- å‹åŠ›æµ‹è¯•
- åŠ¨æ€è·¯ç”±
- æœåŠ¡è¿ç§»
- é‰´æƒ
- é™æµ

### å¦‚ä½•åŠ å…¥Zuul

è¦åœ¨æ‚¨çš„é¡¹ç›®ä¸­åŒ…å«Zuulï¼Œè¯·ä½¿ç”¨ç»„`org.springframework.cloud`å’Œartifact id `spring-cloud-starter-zuul`çš„å¯åŠ¨å™¨ã€‚æœ‰å…³ ä½¿ç”¨å½“å‰çš„Spring Cloudå‘å¸ƒåˆ—è¡¨è®¾ç½®æ„å»ºç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[Spring Cloudé¡¹ç›®é¡µé¢](http://projects.spring.io/spring-cloud/)ã€‚

### åµŒå…¥å¼Zuulåå‘ä»£ç†

Spring Cloudå·²ç»åˆ›å»ºäº†ä¸€ä¸ªåµŒå…¥å¼Zuulä»£ç†ï¼Œä»¥ç®€åŒ–UIåº”ç”¨ç¨‹åºæƒ³è¦ä»£ç†å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªåç«¯æœåŠ¡çš„å‘¼å«çš„éå¸¸å¸¸è§çš„ç”¨ä¾‹çš„å¼€å‘ã€‚æ­¤åŠŸèƒ½å¯¹äºç”¨æˆ·ç•Œé¢å¯¹å…¶æ‰€éœ€çš„åç«¯æœåŠ¡è¿›è¡Œä»£ç†æ˜¯æœ‰ç”¨çš„ï¼Œé¿å…äº†å¯¹æ‰€æœ‰åç«¯ç‹¬ç«‹ç®¡ç†CORSå’ŒéªŒè¯é—®é¢˜çš„éœ€æ±‚ã€‚

è¦å¯ç”¨å®ƒï¼Œä½¿ç”¨`@EnableZuulProxy`æ³¨é‡ŠSpring Bootä¸»ç±»ï¼Œå¹¶å°†æœ¬åœ°è°ƒç”¨è½¬å‘åˆ°ç›¸åº”çš„æœåŠ¡ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå…·æœ‰IDâ€œç”¨æˆ·â€çš„æœåŠ¡å°†æ¥æ”¶æ¥è‡ªä½äº`/users`ï¼ˆå…·æœ‰å‰ç¼€strippedï¼‰çš„ä»£ç†çš„è¯·æ±‚ã€‚ä»£ç†ä½¿ç”¨Ribbonæ¥å®šä½ä¸€ä¸ªé€šè¿‡å‘ç°è½¬å‘çš„å®ä¾‹ï¼Œå¹¶ä¸”æ‰€æœ‰è¯·æ±‚éƒ½ä»¥ [hystrixå‘½ä»¤æ‰§è¡Œ](https://www.springcloud.cc/spring-cloud-dalston.html#hystrix-fallbacks-for-routes)ï¼Œæ‰€ä»¥æ•…éšœå°†æ˜¾ç¤ºåœ¨HystrixæŒ‡æ ‡ä¸­ï¼Œä¸€æ—¦ç”µè·¯æ‰“å¼€ï¼Œä»£ç†å°†ä¸ä¼šå°è¯•è”ç³»æœåŠ¡ã€‚

> æ³¨æ„ï¼šZuulå¯åŠ¨å™¨ä¸åŒ…æ‹¬å‘ç°å®¢æˆ·ç«¯ï¼Œå› æ­¤å¯¹äºåŸºäºæœåŠ¡IDçš„è·¯ç”±ï¼Œæ‚¨è¿˜éœ€è¦åœ¨ç±»è·¯å¾„ä¸­æä¾›å…¶ä¸­ä¸€ä¸ªè·¯ç”±ï¼ˆä¾‹å¦‚Eurekaï¼‰ã€‚

è¦è·³è¿‡è‡ªåŠ¨æ·»åŠ çš„æœåŠ¡ï¼Œè¯·å°†`zuul.ignored-services`è®¾ç½®ä¸ºæœåŠ¡æ ‡è¯†æ¨¡å¼åˆ—è¡¨ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡åŒ¹é…ä¸€ä¸ªè¢«å¿½ç•¥çš„æ¨¡å¼ï¼Œè€Œä¸”åŒ…å«åœ¨æ˜ç¡®é…ç½®çš„è·¯ç”±æ˜ å°„ä¸­ï¼Œé‚£ä¹ˆå®ƒå°†è¢«æ— ç¬¦å·ã€‚ä¾‹ï¼š

application.yml

```yaml
 zuul:
  ignoredServices: '*'
  routes:
    users: /myusers/**
```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ**é™¤** â€œç”¨æˆ·â€ **ä¹‹å¤–**ï¼Œæ‰€æœ‰æœåŠ¡éƒ½è¢«å¿½ç•¥ã€‚

è¦æ‰©å……æˆ–æ›´æ”¹ä»£ç†è·¯ç”±ï¼Œå¯ä»¥æ·»åŠ å¦‚ä¸‹æ‰€ç¤ºçš„å¤–éƒ¨é…ç½®ï¼š

application.yml

```yaml
 zuul:
  routes:
    users: /myusers/**
```

è¿™æ„å‘³ç€å¯¹â€œ/ myusersâ€çš„httpå‘¼å«è½¬å‘åˆ°â€œç”¨æˆ·â€æœåŠ¡ï¼ˆä¾‹å¦‚â€œ/ myusers / 101â€è½¬å‘åˆ°â€œ/ 101â€ï¼‰ã€‚

è¦è·å¾—å¯¹è·¯ç”±çš„æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œæ‚¨å¯ä»¥ç‹¬ç«‹åœ°æŒ‡å®šè·¯å¾„å’ŒserviceIdï¼š

application.yml

```yaml
 zuul:
  routes:
    users:
      path: /myusers/**
      serviceId: users_service
```

è¿™æ„å‘³ç€å¯¹â€œ/ myusersâ€çš„httpå‘¼å«è½¬å‘åˆ°â€œusers_serviceâ€æœåŠ¡ã€‚è·¯ç”±å¿…é¡»æœ‰ä¸€ä¸ªâ€œè·¯å¾„â€ï¼Œå¯ä»¥æŒ‡å®šä¸ºèš‚èšæ ·å¼æ¨¡å¼ï¼Œæ‰€ä»¥â€œ/ myusers / *â€åªåŒ¹é…ä¸€ä¸ªçº§åˆ«ï¼Œä½†â€œ/ myusers / **â€åˆ†å±‚åŒ¹é…ã€‚

åç«¯çš„ä½ç½®å¯ä»¥è¢«æŒ‡å®šä¸ºâ€œserviceIdâ€ï¼ˆç”¨äºå‘ç°çš„æœåŠ¡ï¼‰æˆ–â€œurlâ€ï¼ˆå¯¹äºç‰©ç†ä½ç½®ï¼‰ï¼Œä¾‹å¦‚

application.yml

```yaml
 zuul:
  routes:
    users:
      path: /myusers/**
      url: http://example.com/users_service
```

è¿™äº›ç®€å•çš„URLè·¯ç”±ä¸ä¼šè¢«æ‰§è¡Œä¸º`HystrixCommand`ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨Ribbonå¯¹å¤šä¸ªURLè¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚ä¸ºæ­¤ï¼Œè¯·æŒ‡å®šservice-routeå¹¶ä¸ºserviceIdé…ç½®Ribbonå®¢æˆ·ç«¯ï¼ˆç›®å‰éœ€è¦åœ¨Ribbonä¸­ç¦ç”¨Eurekaæ”¯æŒï¼šè¯¦è§[ä¸Šæ–‡](https://www.springcloud.cc/spring-cloud-dalston.html#spring-cloud-ribbon-without-eureka)ï¼‰ï¼Œä¾‹å¦‚

application.yml

```yaml
zuul:
  routes:
    users:
      path: /myusers/**
      serviceId: users

ribbon:
  eureka:
    enabled: false

users:
  ribbon:
    listOfServers: example.com,google.com
```

å…·ä½“è¯¦ç»†çš„Zuulé…ç½®æ•™ç¨‹å¯ä»¥å‚ç…§å®˜æ–¹æ•™ç¨‹ã€‚

## Spring Cloudé…ç½®ç®¡ç†â€”â€”Config

> Spring Cloud Configä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨é…ç½®æä¾›æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ”¯æŒã€‚ä½¿ç”¨Config Serverï¼Œæ‚¨å¯ä»¥åœ¨æ‰€æœ‰ç¯å¢ƒä¸­ç®¡ç†åº”ç”¨ç¨‹åºçš„å¤–éƒ¨å±æ€§ã€‚

éšç€æœåŠ¡çš„ä¸æ–­å¢å¤šï¼ŒåŒæ—¶æ¯ä¸ªæœåŠ¡ä¹Ÿä¼šæœ‰å¤šä¸ªç¯å¢ƒï¼ˆå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒç­‰ï¼‰ï¼Œæ¯ä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶åˆä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å…¶ä¸­åˆæœ‰è®¸å¤šé…ç½®æ˜¯å¯ä»¥å…±ç”¨çš„ï¼Œå¦‚æœæ¯ä¸ªæœåŠ¡è‡ªå·±å»ç®¡ç†è¿™äº›é…ç½®ï¼Œä¼šç»™ç»´æŠ¤å¸¦æ¥å¾ˆå¤§çš„éº»çƒ¦ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å¼•å…¥é…ç½®ä¸­å¿ƒå»ç»Ÿä¸€ç®¡ç†è¿™äº›é…ç½®ã€‚`Spring Cloud` æä¾›äº† `Spring Cloud Config` æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼Œä½†æ˜¯ä¹Ÿæœ‰ç¤¾åŒºæä¾›çš„æ¯”è¾ƒå¥½çš„å®ç°ï¼Œå¦‚æºç¨‹æä¾›çš„ Apolloä»¥åŠé˜¿é‡Œå·´å·´çš„Nacosä¹Ÿæä¾›é…ç½®ä¸­å¿ƒã€‚ä½†æ˜¯ï¼Œé…ç½®æ›´æ–°åæ€æ ·é€šçŸ¥åˆ°å…·ä½“æœåŠ¡ï¼Œè¿™åˆæ˜¯ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ `Spring Cloud` è¿˜æä¾›äº† `Spring Cloud Bus` ç»„ä»¶ï¼Œæ¥è¿›è¡ŒæœåŠ¡é—´çš„é€šè®¯ã€‚

ç®€å•æ¥è¯´ï¼Œ`Spring Cloud Config`å°±æ˜¯èƒ½å°†å„ä¸ª åº”ç”¨/ç³»ç»Ÿ/æ¨¡å— çš„é…ç½®æ–‡ä»¶å­˜æ”¾åˆ°**ç»Ÿä¸€çš„åœ°æ–¹ç„¶åè¿›è¡Œç®¡ç†**(Git æˆ–è€… SVN)ã€‚

ä½ æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„åº”ç”¨æ˜¯ä¸æ˜¯åªæœ‰å¯åŠ¨çš„æ—¶å€™æ‰ä¼šè¿›è¡Œé…ç½®æ–‡ä»¶çš„åŠ è½½ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„`Spring Cloud Config`å°±æš´éœ²å‡ºä¸€ä¸ªæ¥å£ç»™å¯åŠ¨åº”ç”¨æ¥è·å–å®ƒæ‰€æƒ³è¦çš„é…ç½®æ–‡ä»¶ï¼Œåº”ç”¨è·å–åˆ°é…ç½®æ–‡ä»¶ç„¶åå†è¿›è¡Œå®ƒçš„åˆå§‹åŒ–å·¥ä½œã€‚

è€Œå¯¹é…ç½®æ–‡ä»¶æ›´æ”¹åï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨`Bus`æ¶ˆæ¯æ€»çº¿ +`Spring Cloud Config`è¿›è¡Œé…ç½®çš„åŠ¨æ€åˆ·æ–°ã€‚

> Spring Cloud busé€šè¿‡è½»é‡æ¶ˆæ¯ä»£ç†è¿æ¥å„ä¸ªåˆ†å¸ƒçš„èŠ‚ç‚¹ã€‚è¿™ä¼šç”¨åœ¨å¹¿æ’­çŠ¶æ€çš„å˜åŒ–ï¼ˆä¾‹å¦‚é…ç½®å˜åŒ–ï¼‰æˆ–è€…å…¶ä»–çš„æ¶ˆæ¯æŒ‡ä»¤ã€‚Spring busçš„ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡åˆ†å¸ƒå¼çš„å¯åŠ¨å™¨å¯¹spring bootåº”ç”¨è¿›è¡Œæ‰©å±•ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å»ºç«‹ä¸€ä¸ªå¤šä¸ªåº”ç”¨ä¹‹é—´çš„é€šä¿¡é¢‘é“ã€‚ç›®å‰å”¯ä¸€å®ç°çš„æ–¹å¼æ˜¯ç”¨AMQPæ¶ˆæ¯ä»£ç†ä½œä¸ºé€šé“ï¼ŒåŒæ ·ç‰¹æ€§çš„è®¾ç½®ï¼ˆæœ‰äº›å–å†³äºé€šé“çš„è®¾ç½®ï¼‰åœ¨æ›´å¤šé€šé“çš„æ–‡æ¡£ä¸­ã€‚

å¯ä»¥å‚ç…§ä¸‹å›¾ç†è§£ï¼š

![image-20200402160737564](img/ææ‡‚SpringCloudå¾®æœåŠ¡æ¶æ„/4.png)

# æ€»ç»“

æœ¬ç¯‡æ–‡ç« åªæ˜¯åˆæ­¥è¯´æ˜äº†`Spring Cloud`çš„å„ä¸ªç»„ä»¶ï¼Œä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š

- Eureka æœåŠ¡å‘ç°æ¡†æ¶
- Hystrix æœåŠ¡é™çº§ç†”æ–­å™¨
- Ribbon è¿›ç¨‹å†…è´Ÿè½½å‡è¡¡å™¨
- Open Feign æœåŠ¡è°ƒç”¨æ˜ å°„
- Zuul å¾®æœåŠ¡ç½‘å…³
- Config å¾®æœåŠ¡ç»Ÿä¸€é…ç½®ä¸­å¿ƒ
- Bus æ¶ˆæ¯æ€»çº¿

çœ‹åˆ°è¿™é‡Œï¼Œå¤§å®¶åº”è¯¥å¯¹Spring Cloudæ¶æ„ä¹Ÿæœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œå…·ä½“åº”ç”¨è¿˜éœ€è¦è‡ªå·±å†å®è·µä¸­æ¢è®¨ã€‚